<input type="checkbox" class="theme-switch" id="theme-switch">
<label for="theme-switch" class="theme-switch-label me-2 mb-2" id="theme-switch-label">
  <i class="fas fa-moon"></i>
  <i class="fas fa-sun"></i>
  <span class="ball" id="theme-switch-ball"></span>
</label>

<style>

* {box-sizing: border-box;}

.theme-switch {
  opacity: 0;
}

.theme-switch-label {
  background-color: #383838;
  width: 50px;
  height: 26px;
  border-radius: 50px;
  position: relative;
  padding: 5px;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.fa-sun, .fa-moon {color: #aaaaaa;}

.theme-switch-label .ball {
  background-color: #fff;
  width: 22px;
  height: 22px;
  position: absolute;
  left: 2px;
  top: 2px;
  border-radius: 50%;
}

.theme-switch:checked + .theme-switch-label .ball {
  transform: translateX(24px);
}
</style>

<script>
const themeSwitch = document.getElementById('theme-switch');

function applyTheme(theme) {
  if (theme === 'dark' || (theme === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.body.setAttribute('data-bs-theme', 'dark');
    themeSwitch.checked = true;
  } else {
    document.body.setAttribute('data-bs-theme', 'light');
    themeSwitch.checked = false;
  }
}

function setTheme(theme) {
  localStorage.setItem('theme', theme);
  applyTheme(theme);
}

themeSwitch.addEventListener('change', () => {
  document.body.classList.toggle("dark")

  // set this style only when toogle is made by user
  document.getElementById('theme-switch-label').style.transition = 'transform 0.2s linear';
  document.getElementById('theme-switch-ball').style.transition = 'transform 0.2s linear';
  
  if (themeSwitch.checked) {
    setTheme('dark');
  } else {
    setTheme('light');
  }
});

const savedTheme = localStorage.getItem('theme') || 'system';
applyTheme(savedTheme);

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
  if (localStorage.getItem('theme') === 'system') {
    applyTheme('system');
  }
});
</script>