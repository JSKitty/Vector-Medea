<%
  const cfg = locals.domainConfig?.appearance || {};
  const globalCfg = locals.globalConfig?.appearance|| {};
%>
<div id ="settingsLookAndFeel">
    <h3 class="mt-4">Appearance</h3>
    <form class="form mx-auto">
      <p> In this section, you can personalize the server color scheme and logo according to your specific requirements. 
      </p>
      <%- include('field', {
        type: "file",
        name: "appearance.server.logo.light",
        label: "Light logo",
        description: "Upload a new logo for light theme. Use transparent background.",
        previewSrc: `/static/resources/appearance-server-logo-light.png${selectedDomain ? `?domain=${selectedDomain}` : ""}`,
        previewSize: { width: 180, height: 61 },
        overridable: true
      }) %>
      <%- include('field', {
        type: "file",
        name: "appearance.server.logo.dark",
        label: "Dark logo",
        description: "Upload a new logo for dark theme. Use transparent background.",
        previewSrc: `/static/resources/appearance-server-logo-dark.png${selectedDomain ? `?domain=${selectedDomain}` : ""}`,
        previewSize: { width: 180, height: 61 },
        previewClass: "bg-dark",
        overridable: true
      }) %>
      <label class="mt-3 mb-1 fw-bold">Dynamic background</label>
      <p>Choose the colors for the dynamic background.</p>
      <div class="row mx-auto mb-1">
        <div class="col-12 col-md-4 pb-4 mb-4">
          <input id="appearance.dynamicbackground.color1" name="appearance.dynamicbackground.color1" type="color" class="form-control position-static"><span class="ms-2">Primary</span>
        </div>
        <div class="col-12 col-md-4 pb-4 mb-4">
        <input id= "appearance.dynamicbackground.color2" name="appearance.dynamicbackground.color2" type="color"  class="form-control position-static "><span class="ms-2">Secondary</span>
        </div>
        <div class="col-12 col-md-4 pb-4 mb-4">
          <input id="appearance.dynamicbackground.color3" name="appearance.dynamicbackground.color3" type="color"  class="form-control position-static "><span class="ms-2">Tertiary</span>
        </div>
      </div>
      <div class="mt-3">
        <%- include('field', {
          type: "select",
          name: "appearance.dynamicbackground.orientation",
          label: "Orientation",
          description: "Choose the direction of the gradient.",
          value: cfg.dynamicbackground.orientation,
          globalValue: globalCfg.dynamicbackground.orientation,
          overridable: true,
          options: [
            { value: "to top", label: "To Top" },
            { value: "to right", label: "To Right" },
            { value: "to bottom", label: "To Bottom" },
            { value: "to left", label: "To Left" },
            { value: "to top left", label: "To Top Left" },
            { value: "to top right", label: "To Top Right" },
            { value: "to bottom left", label: "To Bottom Left" },
            { value: "to bottom right", label: "To Bottom Right" }
          ]
        }) %>
        <div class="col-12">
            <div id="appearance.dynamicbackground.gradientbar" class="gradient-bar"><div id="particles-js" style="height: 300px;"></div></div>           
        </div>
        <%- include('field', {
          type: "hidden",
          name: "appearance.dynamicbackground.color1Percent",
          value: cfg.dynamicbackground.color1Percent,
          globalValue: globalCfg.dynamicbackground.color1Percent,
          overridable: true,
          placeholder: "",
          required: true
        }) %>
        <%- include('field', {
          type: "hidden",
          name: "appearance.dynamicbackground.color2Percent",
          value: cfg.dynamicbackground.color2Percent,
          globalValue: globalCfg.dynamicbackground.color2Percent,
          overridable: true,
          placeholder: "",
          required: true
        }) %>
        <%- include('field', {
          type: "hidden",
          name: "appearance.dynamicbackground.color3Percent",
          value: cfg.dynamicbackground.color3Percent,
          globalValue: globalCfg.dynamicbackground.color3Percent,
          overridable: true,
          placeholder: "",
          required: true
        }) %>
        <%- include('field', {
          type: "select",
          name: "appearance.dynamicbackground.particles",
          label: "Particles effect",
          description: "Choose the visual particle effect for the dynamic background.",
          value: cfg.dynamicbackground.particles,
          globalValue: globalCfg.dynamicbackground.particles,
          overridable: true,
          options: [
            { value: "quantum", label: "Quantum" },
            { value: "astral", label: "Astral" },
            { value: "nexus", label: "Nexus" },
            { value: "none", label: "None" }
          ]
        }) %>
      </div>
      <div class="row mx-auto mt-3 ">
        <label for="appearance.dynamicbackground.theme" class="mt-2 mb-1 fw-bold">Dynamic background themes</label>
        <div class="col-12 col-md-9">
          <%- include('field', {
            type: "select",
            name: "appearance.dynamicbackground.theme",
            label: "Theme",
            value: cfg.dynamicbackground.theme,
            globalValue: globalCfg.dynamicbackground.theme,
            overridable: true,
            options: Object.keys(locals.settingsLookAndFeelThemes || {}).map(key => ({ value: key, label: key })),
          }) %>
        </div>
        <div class="col-4 col-md-3 mt-2 mt-md-0">
          <input type='text' class="d-none" id='appearance.dynamicbackground.theme.default' name='appearance.dynamicbackground.theme.default' value='false'>
          <button class="form-control btn btn-md mt-1 btn-primary" type="button" onclick="updateTheme('','','','','','','','',true)">Restore</button>            
        </div>
      </div>  
      <div class="col-12 col-md-3 mb-5 mt-4 pb-5 pb-lg-0 mb-lg-2">
        <button class="btn btn-lg mb-4 btn-primary w-100" name="Submit" type="button" onclick="saveSettings()">Save</button>
      </div>
    </form>
  </div>
  <script src="/static/js/particles.min.js"></script>
  <script type="application/json" id="theme-data-json">
    <%- JSON.stringify(locals.settingsLookAndFeelThemes || {}) %>
  </script>
  <style>
    .gradient-bar {
        position: relative;
        height: 300px; 
        width: 100%; 
        border-radius: 5px; 
        margin-top: 10px;
    }
    
    .gradient-bar .handle {
        position: absolute;
        bottom: 25%;
        width: 9px;
        height: 40%;
        background: #fff;
        cursor: ew-resize;
        border-radius: 3px;
    }
    
    </style>