<div class="row">
    <div class="text-center col-11 col-sm-9 col-md-8 mx-auto">
        <h1 class="display-4 mb-1 pb-2 font-weight-normal gradient-text">Be part of our community</h1>
        <p class="lead">Claim your nostr address to manage your nostr profile page, multimedia files, lightning redirects and much more. Thank you for giving us the opportunity to serve you.</p>
      </div>
</div>
<div class="row">
    <div class="col-11 col-sm-9 col-md-8 col-lg-6 col-xl-5 col-xxl-4 mx-auto">
        <form class="form">
          <div class="input-group mb-3 mt-2">
            <span class="input-group-text" id="addon-wrapping">Select domain name</span>
            <select class="form-select" aria-label="Domain selection" id="domain-selection">
            </select>
          </div>
            <div class="input-group mb-3 mt-2">
              <input type="text" data-otc='username' class="form-control " id="input-register-username" placeholder="username" required autocomplete="username">
              <span class="input-group-text" id="input-register-domain">@domain.com</span>
            </div>
            
            <input type="text" data-otc='pubkey' class="form-control mt-2 mb-3" id="input-register-pubkey" placeholder="public key (npub or hex)" required autocomplete="pubkey">
            <div class="input-group flex-nowrap mt-2">
              <span class="input-group-text" id="addon-wrapping">Optional</span>
              <input type="password" data-otc='password' id="password" name="password" class="form-control input-password" placeholder="Password" autocomplete="current-password">
              <button id="toggle-password" type="button" class="d-none"
              aria-label="Show password as plain text. Warning: this will display your password on the screen.">
            </button>
            </div>
          </form>
          
      <div id="register-buttons" class="mt-3">
        <p class="text-center">Register using a one time code sent via nostr direct message or using a browser extension</p>
        <div class="d-grid mb-3 mt-3 w-300 mx-auto">
          <button class="btn btn-lg btn-primary" name="otc_submit" id="otc_submit" type="button" onclick=""><i class="nostr-logo me-2" ></i>One time register code</button>
        </div>
      <div class=" hr-text w-50 mx-auto">or</div> 
        <div class="d-grid w-300 mx-auto mt-3 mb-3">
          <button class="btn btn-lg btn-primary" name="NIP07_submit" id="NIP07_submit" type="button" onclick=""><i class="nostr-logo me-2"></i>Browser extension</button>
        </div>
      </div>
    </div>  
  </div>  
<script src="/static/js/form.js"></script>

<script>
document.addEventListener('DOMContentLoaded', async (event) => {

  const domains =  await fetch('/api/v2/domains', {
    method: 'GET',
    headers: {
      'Authorization': 'Bearer ' + localStorage.getItem('authkey')
    }
  })
  .then(response => response.json())
  .then(async data => {
    const select = document.getElementById('domain-selection');
    const domainLabel = document.getElementById('input-register-domain');
    let counter = 0;
    data.AvailableDomains.forEach(domain => {
      counter == 0 ? domainLabel.innerText = '@' + domain : null;
      const option = document.createElement('option');
      option.value = domain;
      option.text = domain;
      select.appendChild(option);
      counter++;
    });
    await localStorage.setItem('authkey', data.authkey);
  })
  .catch((error) => {
    console.error('Error:', error);
  });

   // Update domain input when selection changes
   document.getElementById('domain-selection').addEventListener('change', function() {
        const selectedDomain = this.value;
        document.getElementById('input-register-domain').innerText = '@' + selectedDomain;
    });

  
});

</script>